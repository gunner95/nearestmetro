"use strict";angular.module("metroApp",["ngRoute","geolocation"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).otherwise({redirectTo:"/"})}]),angular.module("metroApp").controller("MainCtrl",["$scope","$http","geolocation","gservice","$window","$timeout",function(a,b,c,d,e,f){a.formData={},a.data=[],a.formData.transport="WALKING",a.geoL=function(){c.getLocation().then(function(b){a.formData.longitude=parseFloat(b.coords.longitude).toFixed(3),a.formData.latitude=parseFloat(b.coords.latitude).toFixed(3),a.formData.htmlverified="Yep (Thanks for giving us real data!)",d.refresh(a.formData.latitude,a.formData.longitude)},function(){console.log("error")})},a.geoL(),a.submit=function(){console.log(a.formData);var c={username:a.formData.username,location:[a.formData.longitude,a.formData.latitude]},g={latitude:parseFloat(a.formData.latitude),longitude:parseFloat(a.formData.longitude)},h=new google.maps.LatLng(parseFloat(a.formData.latitude),parseFloat(a.formData.longitude));b.post("/query",g).then(function(b){if(console.log(b),0==b.data.length)e.alert("too far from any metro station");else{var c=new google.maps.LatLng(parseFloat(b.data[0].location[1]),parseFloat(b.data[0].location[0]));d.plotPath(h,c,a.formData.transport),f(function(){void 0!=d.distance&&(a.distance=d.distance.text,a.timeTaken=d.timeTaken.text)},500)}},function(){console.log("unable to retrieve data")}),console.log(c)}}]),angular.module("metroApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("metroApp").factory("gservice",["$http","$q",function(a,b){var c={},d=[],e=28.6139,f=77.209;c.refresh=function(c,i){d=[],f=i,e=c;var j=a.get("/users"),k=a.get("/users2");b.all([j,k]).then(function(a){var b=a[0].data.concat(a[1].data);d=g(b),h(c,i)},function(){console.log("error in refresh method")})},c.plotPath=function(a,b,d){function e(a,b){console.log(a),c.distance=a.rows[0].elements[0].distance,c.timeTaken=a.rows[0].elements[0].duration}var f={zoom:10,center:a,mapTypeId:google.maps.MapTypeId.ROADMAP},g=new google.maps.Map(document.getElementById("map"),f),h=new google.maps.DirectionsService,i=new google.maps.DistanceMatrixService,j=google.maps.DirectionsTravelMode.WALKING;"DRIVING"==d&&(j=google.maps.DirectionsTravelMode.DRIVING);var k={origin:a,destination:b,travelMode:j};h.route(k,function(a,b){"OK"===b?new google.maps.DirectionsRenderer({map:g,directions:a}):console.log("error puta")}),i.getDistanceMatrix({origins:[a],destinations:[b],travelMode:j},e)};var g=function(a){for(var b=[],c=a,d=0;d<c.length;d++){var e=a[d],f="<p><b>Username</b>: "+e.username+"<br><b>latitude</b>"+e.location[0]+"<br><b>longitude</b>"+e.location[1]+"</p>";b.push({latlon:new google.maps.LatLng(parseFloat(e.location[1]),parseFloat(e.location[0])),message:new google.maps.InfoWindow({content:f,maxWidth:320}),username:e.username})}return b},h=function(a,b){var c={lat:parseFloat(e),lng:parseFloat(f)};if(!g)var g=new google.maps.Map(document.getElementById("map"),{zoom:14,center:c});d.forEach(function(a,b){if(b==d.length-1)var c=new google.maps.Marker({position:a.latlon,map:g,title:"Big Map",icon:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"});else var c=new google.maps.Marker({position:a.latlon,map:g,title:"Big Map",icon:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"});google.maps.event.addListener(c,"click",function(b){currentSelectedMarker=a,a.message.open(g,c)})})};return google.maps.event.addDomListener(window,"load",c.refresh(e,f)),c}]),angular.module("metroAppApp").run(["$templateCache",function(a){a.put("views/about.html",'<div id="page-wrapper"> <div class="mainConatiner"> <div class="container-fluid"> <div class="row"> <div class="col-md-6 col-sm-12"> <div class="panel panel-info"> <div class="panel-heading"> <center>What\'s this App?</center> </div> <div class="panel-body"> Very Simple to use application, which takes automatically takes your location and tells you your nearest delhi metro station. <br>Also it shows the path you need to follow </div> </div> </div> <div class="col-md-6 col-sm-12"> <div class="panel panel-success"> <div class="panel-heading"> <center>How to use it?</center> </div> <div class="panel-body"> <ul class="list-group"> <li class="list-group-item">Press Allow when the location pop-up comes</li> <li class="list-group-item">Select how will you be going to the station, ie Walking or Driving</li> <li class="list-group-item">Entering your name is optional</li> <li class="list-group-item">Press Submit and you should have your path!</li> </ul> </div> </div> </div> </div> </div> </div> </div>'),a.put("views/main.html",'<div id="page-wrapper"> <div class="mainConatiner"> <div class="container-fluid"> <div class="row mainRow"> <div class="col-md-8"> <h3 ng-if="timeTaken!=undefined">Time to destination is {{timeTaken}} and distance left is {{distance}}</h3> </div> <div class="col-md-8"> <div id="map"></div> </div> <div class="col-md-4"> <div class="panel panel-default"> <div class="panel-heading"> <h2>Welcome</h2> </div> <div class="panel-body"> <div class="form-group"> <label for="username">Username</label> <input type="text" class="form-control" id="username" ng-model="formData.username"> </div> <div class="form-group"> <label for="latitude">Latitude</label> <input type="text" class="form-control" ng-model="formData.latitude"> </div> <div class="form-group"> <label for="longitude">longitude</label> <input type="text" class="form-control" ng-model="formData.longitude"> </div> <label>Mode of Transport</label><br> <div class="radio"> <label><input type="radio" ng-model="formData.transport" value="WALKING">Walking</label> </div> <div class="radio"> <label><input type="radio" ng-model="formData.transport" value="DRIVING">Driving</label> </div> <input type="button" class="btn btn-primary btn-block" value="Track Me" ng-click="geoL()"> <input type="button" class="btn btn-danger btn-block" value="Submit" ng-click="submit()"> </div> </div> </div> </div> </div> </div> </div>')}]);